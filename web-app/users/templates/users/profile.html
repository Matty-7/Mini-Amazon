{% extends "amazon/base.html" %}
{% load widget_tweaks %}
{% block content %}
<div class="row">
  <!-- 左侧个人卡片 -->
  <div class="col-md-4 mb-4">
    <div class="side-card text-center">
      <h4 class="mb-1">{{ user.username }}</h4>
      <small class="text-muted">{{ user.email }}</small>
      <hr>
      <p class="mb-2">
        <span class="text-muted">Seller</span>：
        {% if user.profile.is_seller %}
           <span class="badge badge-success">Yes</span>
        {% else %}
           <span class="badge badge-secondary">No</span>
        {% endif %}
      </p>
      <a href="{% url 'logout' %}" class="btn btn-outline-danger btn-sm">Logout</a>
    </div>
  </div>

  <!-- 右侧多 Tab 表单 -->
  <div class="col-md-8">
    <ul class="nav nav-tabs" id="profileTab" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="info-tab" data-toggle="tab"
           href="#info" role="tab">Profile</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="password-tab" data-toggle="tab"
           href="#password" role="tab">Password</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="optional-tab" data-toggle="tab"
           href="#optional" role="tab">Optional</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="seller-tab" data-toggle="tab"
           href="#seller" role="tab">Seller</a>
      </li>
    </ul>

    <div class="tab-content py-4">
      <!-- Profile -->
      <div class="tab-pane fade show active" id="info" role="tabpanel">
        <form method="POST" novalidate class="needs-validation">
          {% csrf_token %}
          <input type="hidden" name="operation" value="update_profile">
          <div class="form-group">
            <label>Username</label>
            <input name="username" required class="form-control" value="{{ username }}">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input name="email" type="email" required class="form-control" value="{{ email }}">
          </div>
          
          <ul class="mt-2">
            <li>Your username can't contain space.</li>
            <li>Your username can't be duplicate with any other user.</li>
          </ul>
          
          {% if name_errors %}
            <div class="alert alert-danger py-1">
              <ul>
              {% for error in name_errors %}
                <li>{{ error }}</li>
              {% endfor %}
              </ul>
            </div>
          {% endif %}
          
          <button class="btn btn-primary">Save</button>
        </form>
      </div>

      <!-- Password -->
      <div class="tab-pane fade" id="password" role="tabpanel">
        <form method="POST">
          {% csrf_token %}
          <input type="hidden" name="operation" value="update_password">
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>Old Password</label>
              <input name="old_password" type="password" class="form-control" required>
            </div>
            <div class="form-group col-md-6">
              <label>New Password</label>
              <input name="new_password" type="password" class="form-control" required>
            </div>
          </div>
          
          <div class="form-group">
            <span class="text-muted">{{ help_text }}</span>
          </div>
          
          {% if password_errors %}
            <div class="alert alert-danger">
              <ul>
              {% for error in password_errors %}
                <li>{{ error }}</li>
              {% endfor %}
              </ul>
            </div>
          {% endif %}
          
          <button class="btn btn-primary">Update</button>
        </form>
      </div>

      <!-- Optional -->
      <div class="tab-pane fade" id="optional" role="tabpanel">
        <form method="POST">
          {% csrf_token %}
          <input type="hidden" name="operation" value="update_optional">
          <div class="form-group">
            <label>Default address</label>
            <div class="form-row">
              <div class="form-group col-md-6">
                <label>X</label>
                <input name="default_x" type="number" class="form-control"
                      value="{% if user.profile.default_x != -1 %}{{ user.profile.default_x }}{% endif %}">
              </div>
              <div class="form-group col-md-6">
                <label>Y</label>
                <input name="default_y" type="number" class="form-control"
                      value="{% if user.profile.default_y != -1 %}{{ user.profile.default_y }}{% endif %}">
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label>UPS Account</label>
            <input name="ups_name" class="form-control" value="{{ user.profile.ups_name }}">
          </div>
          
          <button class="btn btn-primary">Save</button>
        </form>
      </div>
      
      <!-- Seller -->
      <div class="tab-pane fade" id="seller" role="tabpanel">
        <form method="POST">
          {% csrf_token %}
          <input type="hidden" name="operation" value="update_seller">
          
          <div class="form-group">
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="register_seller" 
                     name="register_seller" value="seller" 
                     {% if user.profile.is_seller %}checked{% endif %}>
              <label class="custom-control-label" for="register_seller">Register as a seller</label>
            </div>
          </div>
          
          <button class="btn btn-primary">Update</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
    <script type="text/javascript">
        function check_username() {
            return false;
        }

        function check_password() {
            return false;
        }
    </script>
{% endblock script %}
